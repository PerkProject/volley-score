<!DOCTYPE html>
<html>
<head>
  <title>OBS Scoreboard</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/css/bulma.min.css" crossorigin="anonymous" />
  <link rel="stylesheet" href="/css/control-panel.css" />
  <link rel="stylesheet" href="/chosen/ImageSelect.css" type="text/css" />
  <link rel="stylesheet" href="/chosen/chosen.css" type="text/css" />
  <link rel="stylesheet" href="/chosen/flat.css" type="text/css" />
</head>
<body>
  <section class="section">
    <h1 class="title is-1">Volleyball Scoreboard</h1>
  </section>
  <section class="section">
    <label class="label" for="matchId">Match ID</label>
    <p class="control">
      <input type="text" class="input is-large" onInput="onMatchIdInput()" placeholder="Match ID" id="matchId" />
    </p>
  </section>
  <section id="scoreLinkSection" class="section is-hidden">
    <label class="label" for="scoreLink">Scoreboard Link</label>
    <p class="control">
      <input type="text" class="input is-large" placeholder="Scoreboard Link" id="scoreLink" readonly />
    </p>
  </section>
  <section id="controlPanel" class="section is-hidden">
  <div class="columns is-mobile">
    <div class="column">
      <label class="label" for="nameA">Home Team</label>
      <p class="control">
        <input type="text" class="input is-large" placeholder="Home Team" id="nameA" />
      </p>

      <select id="logoA" onChange="onLogoAChange()">
        <option value="askim" data-img-src="/logo/askim.svg">Askim</option>
        <option value="austratt" data-img-src="/logo/austratt.svg">Austrått</option>
        <option value="bktromso" data-img-src="/logo/bktromso.svg">BK Tromsø</option>
        <option value="blindheim" data-img-src="/logo/blindheim.svg">Blindheim</option>
        <option value="blussuvoll" data-img-src="/logo/blussuvoll.svg">Blussuvoll</option>
        <option value="bsi" data-img-src="/logo/bsi.svg">BSI</option>
        <option value="dristug" data-img-src="/logo/dristug.svg">Dristug</option>
        <option value="egersund" data-img-src="/logo/egersund.svg">Egersund</option>
        <option value="forde" data-img-src="/logo/forde.svg">Førde</option>
        <option value="gneist" data-img-src="/logo/gneist.svg">Gneist</option>
        <option value="koll" data-img-src="/logo/koll.svg">Koll</option>
        <option value="ksk" data-img-src="/logo/ksk.svg">KSK</option>
        <option value="lierne" data-img-src="logo/lierne.svg">Lierne</option>
        <option value="ntnui" data-img-src="/logo/ntnui.svg">NTNUI</option>
        <option value="oksil" data-img-src="/logo/oksil.svg">ØKSIL</option>
        <option value="osi" data-img-src="/logo/osi.svg">OSI</option>
        <option value="oslovolley" data-img-src="/logo/oslovolley.svg">Oslo Volley</option>
        <option value="randaberg" data-img-src="/logo/randaberg.svg">Randaberg</option>
        <option value="sandnes" data-img-src="/logo/sandnes.svg">Sandnes</option>
        <option value="spiritlorenskog" data-img-src="/logo/spiritlorenskog.svg">Spirit Lørenskog</option>
        <option value="stod" data-img-src="/logo/stod.svg">Stod</option>
        <option value="sunnfjord" data-img-src="/logo/sunnfjord.svg">Sunnfjord</option>
        <option value="tonsberg" data-img-src="/logo/tonsberg.svg">Tønsberg</option>
        <option value="tvn" data-img-src="/logo/tvn.svg">TVN</option>
        <option value="vestli" data-img-src="/logo/vestli.svg">Vestli</option>
        <option value="viking" data-img-src="/logo/viking.svg">Viking</option>
      </select>

      <div class="notification is-success">
        <div class="counters is-flipped-on-desktop">
          <div class="counter is-big-on-desktop">
            <div class="point">
              <span class="desc">POINTS</span>
              <span id="pointsA">0</span>
            </div>
            <a class="button is-large score-button" onclick="onClickPlussPointsA()" >+</a>
            <a class="button is-large score-button" onclick="onClickSubtractPointsA()">-</a>
          </div>
          <div class="counter">
            <div class="point">
              <span class="desc">SET</span>
              <span id="setA">0</span>
            </div>
            <a class="button is-large score-button" onclick="onClickPlussSetA()" >+</a>
            <a class="button is-large score-button" onclick="onClickSubtractSetA()">-</a>
          </div>
        </div>
      </div>
    </div>
    <div class="column">
      <label class="label" for="nameB">Away Team</label>
      <p class="control">
        <input type="text" class="input is-large" placeholder="Away Team" id="nameB" />
      </p>

      <select id="logoB" onChange="onLogoBChange()">
        <option value="askim" data-img-src="/logo/askim.svg">Askim</option>
        <option value="austratt" data-img-src="/logo/austratt.svg">Austrått</option>
        <option value="bktromso" data-img-src="/logo/bktromso.svg">BK Tromsø</option>
        <option value="blindheim" data-img-src="/logo/blindheim.svg">Blindheim</option>
        <option value="blussuvoll" data-img-src="/logo/blussuvoll.svg">Blussuvoll</option>
        <option value="bsi" data-img-src="/logo/bsi.svg">BSI</option>
        <option value="dristug" data-img-src="/logo/dristug.svg">Dristug</option>
        <option value="egersund" data-img-src="/logo/egersund.svg">Egersund</option>
        <option value="forde" data-img-src="/logo/forde.svg">Førde</option>
        <option value="gneist" data-img-src="/logo/gneist.svg">Gneist</option>
        <option value="koll" data-img-src="/logo/koll.svg">Koll</option>
        <option value="ksk" data-img-src="/logo/ksk.svg">KSK</option>
        <option value="lierne" data-img-src="/logo/lierne.svg">Lierne</option>
        <option value="ntnui" data-img-src="/logo/ntnui.svg">NTNUI</option>
        <option value="oskil" data-img-src="/logo/oksil.svg">ØKSIL</option>
        <option value="osi" data-img-src="/logo/osi.svg">OSI</option>
        <option value="oslovolley" data-img-src="/logo/oslovolley.svg">Oslo Volley</option>
        <option value="randaberg" data-img-src="/logo/randaberg.svg">Randaberg</option>
        <option value="sandnes" data-img-src="/logo/sandnes.svg">Sandnes</option>
        <option value="spiritlorenskog" data-img-src="/logo/spiritlorenskog.svg">Spirit Lørenskog</option>
        <option value="stod" data-img-src="/logo/stod.svg">Stod</option>
        <option value="sunnfjord" data-img-src="/logo/sunnfjord.svg">Sunnfjord</option>
        <option value="tonsberg" data-img-src="/logo/tonsberg.svg">Tønsberg</option>
        <option value="tvn" data-img-src="/logo/tvn.svg">TVN</option>
        <option value="vestli" data-img-src="/logo/vestli.svg">Vestli</option>
        <option value="viking" data-img-src="/logo/viking.svg">Viking</option>
      </select>


      <div class="notification is-info">
        <div class="counters">
          <div class="counter is-big-on-desktop">
            <div class="point">
              <span class="desc">POINTS</span>
              <span id="pointsB">0</span>
            </div>
            <a class="button is-large score-button" onclick="onClickPlussPointsB()" >+</a>
            <a class="button is-large score-button" onclick="onClickSubtractPointsB()">-</a>
          </div>
          <div class="counter">
            <div class="point">
              <span class="desc">SET</span>
              <span id="setB">0</span>
            </div>
            <a class="button is-large score-button" onclick="onClickPlussSetB()" >+</a>
            <a class="button is-large score-button" onclick="onClickSubtractSetB()">-</a>
          </div>
        </div>
      </div>
    </div>
  </div>
  </section>
  <section id="buttonList" class="section is-flex is-hidden">
    <div class="control">
      <a class="button is-large is-danger" onClick="reset()">Reset points</a>
      <a class="button is-large" onClick="save()">Save team names</a>
    </div>
  </section>
  <script
    src="https://code.jquery.com/jquery-3.1.1.min.js"
    integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
    crossorigin="anonymous">
  </script>
  <script type="text/javascript" src="/chosen/chosen.jquery.js"></script>
  <script type="text/javascript" src="/chosen/ImageSelect.jquery.js"></script>

  <script>
    var defaultState = {
      matchId: '',
      pointsA: 0,
      pointsB: 0,
      setA: 0,
      setB: 0,
      nameA: 0,
      nameB: 0,
      logoA: '',
      logoB: '',
    };

    var state = Object.assign({}, defaultState);

    function onClickPlussPointsA() {
      state.pointsA++;
      document.getElementById("pointsA").innerHTML = state.pointsA;
      save();
    }

    function onClickSubtractPointsA() {
      state.pointsA--;
      document.getElementById("pointsA").innerHTML = state.pointsA;
      save();
    }

    function onClickPlussPointsB() {
      state.pointsB++;
      document.getElementById("pointsB").innerHTML = state.pointsB;
      save();
    }

    function onClickSubtractPointsB() {
      state.pointsB--;
      document.getElementById("pointsB").innerHTML = state.pointsB;
      save();
    }

    function onClickPlussSetA() {
      state.setA++;
      document.getElementById("setA").innerHTML = state.setA;
      save();
    }

    function onClickSubtractSetA() {
      state.setA--;
      document.getElementById("setA").innerHTML = state.setA;
      save();
    }

    function onClickPlussSetB() {
      state.setB++;
      document.getElementById("setB").innerHTML = state.setB;
      save();
    }

    function onClickSubtractSetB() {
      state.setB--;
      document.getElementById("setB").innerHTML = state.setB;
      save();
    }

    function onLogoAChange() {
      var selectA = document.getElementById('logoA');
      state.logoA = selectA.options[selectA.selectedIndex].value;
      if (state.logoA) {
        logoTeamName = selectA.options[selectA.selectedIndex].text;
        document.getElementById('nameA').value = logoTeamName;
        save();
      }
    }

    function onLogoBChange() {
      var selectB = document.getElementById('logoB');
      state.logoB = selectB.options[selectB.selectedIndex].value;
      if (state.logoB) {
        logoTeamName = selectB.options[selectB.selectedIndex].text;
        document.getElementById('nameB').value = logoTeamName;
        save();
      }
    }

    function onMatchIdInput() {
      state.matchId = document.getElementById('matchId').value || '';
      if (state.matchId.length < 3) {
        document.getElementById('buttonList').classList.add('is-hidden');
        document.getElementById('controlPanel').classList.add('is-hidden');
        document.getElementById('scoreLinkSection').classList.add('is-hidden');
        return;
      }
      load();
      document.getElementById('buttonList').classList.remove('is-hidden');
      document.getElementById('controlPanel').classList.remove('is-hidden');
      document.getElementById('scoreLinkSection').classList.remove('is-hidden');
      document.getElementById('scoreLink').value =
        window.location.href + 'scoreboard.html?matchId=' + state.matchId;
    }

    function save() {
      state.nameA = document.getElementById("nameA").value || "";
      state.nameB = document.getElementById("nameB").value || "";

      jQuery.ajax({
        contentType: 'application/json; charset=utf-8',
        data: JSON.stringify(state),
        type: 'POST',
        url: '/update/' + state.matchId,
      });
    }

    function load() {
      jQuery.get('/scores/' + state.matchId)
      .done(function(data) {
        state = Object.assign({}, state, data);
        refresh();
      });
    }

    function reset() {
      state.pointsA = 0;
      state.pointsB = 0;
      refresh();
      save();
    }

    function refresh() {
      console.log('refreshing!');
      document.getElementById("pointsA").innerHTML = state.pointsA;
      document.getElementById("pointsB").innerHTML = state.pointsB;
      document.getElementById("setA").innerHTML = state.setA;
      document.getElementById("setB").innerHTML = state.setB;
      // Set logo A
      $("#logoA").val(state.logoA);
      $("#logoA").trigger("chosen:updated");
      // Set logo B
      $("#logoB").val(state.logoB);
      $("#logoB").trigger("chosen:updated");

      document.getElementById('nameA').value = state.nameA;
      document.getElementById('nameB').value = state.nameB;
    }
    $('#logoA').chosen({ width:"100%", disable_search_threshold: 100 });
    $('#logoB').chosen({ width:"100%", disable_search_threshold: 100 });
    refresh();
    </script>
</body>
</html>
